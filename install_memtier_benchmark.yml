#cloud-config

## packages did not work, instead you can run all the cli commands in the runcmd.
# # Commands to run
runcmd:
  - "apt-get -y install make"
  - "apt-get -y install build-essential"
  - "apt-get -y install autoconf"
  - "apt-get -y install automake"
  - "apt-get -y install libpcre3-dev"
  - "apt-get -y install libevent-dev"
  - "apt-get -y install pkg-config"
  - "apt-get -y install zlib1g-dev"
  - "apt-get -y install libssl-dev"
  - "git clone https://github.com/RedisLabs/memtier_benchmark"
  - "cd memtier_benchmark"
  - "autoreconf -iv && ./configure && make install"
  - "${memtier_data_input_1} -s ${test_acre_url_1} -p ${acre_port_1} -a ${access_key}"
  - "sudo ${memtier_benchmark_1} -s ${test_acre_url_1} -p ${acre_port_1} -a ${access_key} --json-out-file ${outfile_name_1} --out-file ${txt_outfile_name_1}"
  - "sleep 10"
  - "cd /"
  - "wget https://aka.ms/downloadazcopy-v10-linux" 
  - "tar -xvf downloadazcopy-v10-linux"   
  - "sudo cp ./azcopy_linux_amd64_*/azcopy /usr/bin/"
  - "sleep 5"
  - "sudo azcopy login --identity"
  - "sleep 5"
  - "sudo azcopy copy '/memtier_benchmark/${outfile_name_1}' '${containersasurl}'"
  - "sudo azcopy copy '/memtier_benchmark/${txt_outfile_name_1}' '${containersasurl}'"
  - "sleep 10"
  - "sudo ${memtier_benchmark_2} -s ${test_acre_url_1} -p ${acre_port_1} -a ${access_key} --json-out-file ${outfile_name_2} --out-file ${txt_outfile_name_2}"
  - "sleep 5"
  - "sudo azcopy copy '/memtier_benchmark/${outfile_name_2}' '${containersasurl}'"
  - "sudo azcopy copy '/memtier_benchmark/${txt_outfile_name_2}' '${containersasurl}'"